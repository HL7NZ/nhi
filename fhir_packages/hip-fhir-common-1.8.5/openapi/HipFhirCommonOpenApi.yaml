openapi: "3.0.1"
info:
  title: "hip-hpi-fhir-dev"
  description: "HPI FHIR - dev gateway"
  version: "2021-06-14T20:18:00Z"
servers:
- url: "https://gb2r96qpik.execute-api.ap-southeast-2.amazonaws.com/{basePath}"
  variables:
    basePath:
      default: "dev"
paths:

components:

  parameters:

          nhiId:
            name: nhiId
            in: path
            description: id identifies the kind of post operation
            required: true
            allowEmptyValue: false
            style: simple
            schema:
              $ref: '#/components/schemas/NhiNumber'
              
          X-correlation-ID:
            name: "X-correlation-ID"
            in: "header"
            required: false
            schema:
              type: "string"
              
          X-Request-Id:
              name: "X-Request-Id"
              in: "header"
              required: false
              schema:
                type: "string"
                  
          x-api-key:  
              name: "x-api-key"
              in: "header"
              required: true
              schema:
                type: "string" 
           
          userid:    
              name: "userid"
              in: "header"
              required: true
              schema:
                type: "string"
               

  schemas:
    positiveInt:
      pattern: "^[1-9][0-9]*$"
      type: number
      description: An integer with a value that is positive (e.g. >0)
        
    Element:
      description: Base definition for all elements in a resource.
      properties:
        id:
          description: Unique id for the element within a resource (for internal references).
            This may be any string value that does not contain spaces.
          "$ref": "#/components/schemas/string"
      
      additionalProperties: false

    ContactPoint:
      description: Details for all kinds of technology mediated contact points for a person
        or organization, including telephone, email, etc.
      properties:
        id:
          description: Unique id for the element within a resource (for internal references).
            This may be any string value that does not contain spaces.
          "$ref": "#/components/schemas/string"
        
        system:
          description: Telecommunications form for contact point - what communications
            system is required to make use of the contact.
          enum:
          - phone
          - fax
          - email
          - pager
          - url
          - sms
          - other
        _system:
          description: Extensions for system
          "$ref": "#/components/schemas/Element"
        value:
          description: The actual contact point details, in a form that is meaningful
            to the designated communication system (i.e. phone number or email address).
          "$ref": "#/components/schemas/string"
        _value:
          description: Extensions for value
          "$ref": "#/components/schemas/Element"
        use:
          description: Identifies the purpose for the contact point.
          enum:
          - home
          - work
          - temp
          - old
          - mobile
        _use:
          description: Extensions for use
          "$ref": "#/components/schemas/Element"
        rank:
          description: Specifies a preferred order in which to use a set of contacts.
            ContactPoints with lower rank values are more preferred than those with higher
            rank values.
          "$ref": "#/components/schemas/positiveInt"
        _rank:
          description: Extensions for rank
          "$ref": "#/components/schemas/Element"
        period:
          description: Time period when the contact point was/is in use.
          "$ref": "#/components/schemas/Period"
      additionalProperties: false
      
    date:
      pattern: "^([0-9]([0-9]([0-9][1-9]|[1-9]0)|[1-9]00)|[1-9]000)(-(0[1-9]|1[0-2])(-(0[1-9]|[1-2][0-9]|3[0-1]))?)?$"
      type: "string"
      description: "A date or partial date (e.g. just year or year + month). There\
        \ is no time zone. The format is a union of the schema types gYear, gYearMonth\
        \ and date.  Dates SHALL be valid dates."
    
    id:
      pattern: "^[A-Za-z0-9\\-\\.]{1,64}$"
      type: "string"
      description: "Any combination of letters, numerals, \"-\" and \".\", with a\
        \ length limit of 64 characters.  (This might be an integer, an unprefixed\
        \ OID, UUID or any other identifier pattern that meets these constraints.)\
        \  Ids are case-insensitive."
    
    Meta:
      type: "object"
      properties:
        versionId:
          $ref: "#/components/schemas/id"
        security:
          type: "array"
          description: "Security labels applied to this resource. These tags connect\
            \ specific resources to the overall security policy and infrastructure."
          items:
            $ref: "#/components/schemas/Coding"
        profile:
          type: "array"
          description: "A list of profiles (references to [[[StructureDefinition]]]\
            \ resources) that this resource claims to conform to. The URL is a reference\
            \ to [[[StructureDefinition.url]]]."
          items:
            $ref: "#/components/schemas/canonical"
      description: "The metadata about a resource. This is content in the resource\
        \ that is maintained by the infrastructure. Changes to the content might not\
        \ always be associated with version changes to the resource."
    NesPractitionerRole:
      type: "object"
      properties:
        practitioner:
          $ref: "#/components/schemas/Reference"
        organization:
          $ref: "#/components/schemas/Reference"
        location:
          type: "array"
          items:
            $ref: "#/components/schemas/Reference"
        id:
          $ref: "#/components/schemas/id"
        resourceType:
          type: "string"
          enum:
          - "PractitionerRole"
    ParameterOnlyCertainMatches:
      required:
      - "name"
      type: "object"
      properties:
        valueBoolean:
          type: "boolean"
        name:
          type: "string"
          enum:
          - "onlyCertainMatches"
      additionalProperties: false
    Identifier:
      type: "object"
      properties:
        period:
          $ref: "#/components/schemas/Period"
        system:
          $ref: "#/components/schemas/uri"
        use:
          type: "string"
          description: "The purpose of this identifier."
          enum:
          - "usual"
          - "official"
          - "temp"
          - "nickname"
          - "anonymous"
          - "old"
          - "maiden"
        assigner:
          $ref: "#/components/schemas/Reference"
        id:
          $ref: "#/components/schemas/string"
        type:
          $ref: "#/components/schemas/CodeableConcept"
        value:
          $ref: "#/components/schemas/string"
      additionalProperties: false
      description: "An identifier - identifies some entity uniquely and unambiguously.\
        \ Typically this is used for business identifiers."
    EpisodeOfCare:
      type: "object"
      properties:
        identifier:
          type: "array"
          items:
            $ref: "#/components/schemas/Identifier"
        extension:
          type: "array"
          items:
            anyOf:
              - required:
                  - "url"
                type: "object"
                properties:
                  valueDate:
                    $ref: "#/components/schemas/date"
                  url:
                    type: "string"
                    enum:
                      - "http://hl7.org.nz/fhir/StructureDefinition/enrolment-expiry-date"
                additionalProperties: false
              - required:
                  - "url"
                type: "object"
                properties:
                  valueDate:
                    $ref: "#/components/schemas/date"
                  url:
                    type: "string"
                    enum:
                      - "http://hl7.org.nz/fhir/StructureDefinition/reenrolment-date"
                additionalProperties: false
              - required:
                  - "url"
                type: "object"
                properties:
                  valueReference:
                    $ref: "#/components/schemas/Reference"
                  url:
                      type: "string"
                      enum:
                       - "http://hl7.org.nz/fhir/StructureDefinition/enrolment-owner-org"
                additionalProperties: false
              - required:
                  - "url"
                type: "object"
                properties:
                  valueCodeableConcept:
                    type: "object"
                    properties:
                      coding:
                        type: "array"
                        items:
                          required:
                            - "system"
                          type: "object"
                          properties:
                            system:
                              type: "string"
                              enum:
                                - "https://standards.digital.health.nz/nes-enrolment-termination-reason"
                            code:
                              $ref: "#/components/schemas/code"
                            display:
                              $ref: "#/components/schemas/string"
                            version:
                              $ref: "#/components/schemas/string"
                          additionalProperties: false
                      text:
                        $ref: "#/components/schemas/string"
                    additionalProperties: false
                  url:
                      type: "string"
                      enum:
                       - "http://hl7.org.nz/fhir/StructureDefinition/nes-enrolment-termination-reason"
                additionalProperties: false
              - required:
                  - "url"
                type: "object"
                properties:
                  valueReference:
                    $ref: "#/components/schemas/Reference"
                  url:
                      type: "string"
                      enum:
                       - "http://hl7.org.nz/fhir/StructureDefinition/enrolment-encounter"
                additionalProperties: false
        period:
          $ref: "#/components/schemas/Period"
        careManager:
          $ref: "#/components/schemas/Reference"
        type:
          type: "array"
          items:
              type: "object"
              properties:
                    
                      coding:
                        type: "array"
                        items:
                          required:
                            - "system"
                          type: "object"
                          properties:
                            system:
                              type: "string"
                              enum:
                                - "https://standards.digital.health.nz/nes-enrolment-type"
                            code:
                              $ref: "#/components/schemas/code"
                            display:
                              $ref: "#/components/schemas/string"
                            version:
                              $ref: "#/components/schemas/string"
                          additionalProperties: false
                   
                    
          
        contained:
          type: "array"
          items:
            anyOf:
              - $ref: "#/components/schemas/NesEncounter"
              - $ref: "#/components/schemas/NesPractitionerRole"
              - $ref: "#/components/schemas/Patient"
        managingOrganization:
          $ref: "#/components/schemas/Reference"
        meta:
          $ref: "#/components/schemas/Meta"
        patient:
          $ref: "#/components/schemas/Reference"
        id:
          $ref: "#/components/schemas/id"
        text:
          $ref: "#/components/schemas/string"
        resourceType:
          type: "string"
          description: "This is an Coverage resource"
          enum:
            - "EpisodeOfCare"
        status:
          type: "string"
          enum:
            - "planned"
            - "waitlist"
            - "active"
            - "finished"
      description: "The Entitlement resource exposed by NESEntitlement service."
    Coding:
      type: "object"
      properties:
        system:
          $ref: "#/components/schemas/uri"
        code:
          $ref: "#/components/schemas/code"
        display:
          $ref: "#/components/schemas/string"
        version:
          $ref: "#/components/schemas/string"
      description: "A reference to a code defined by a terminology system."
    NzGeocode:
      type: "object"
      properties:
        latitude:
          type: "object"
          properties:
            valueDecimal:
              $ref: "#/components/schemas/decimal"
            url:
              type: "string"
              enum:
              - "latitude"
          description: "The latitude of the geocode"
        datumCode:
          type: "object"
          properties:
            valueCodeableConcept:
              type: "object"
              properties:
                coding:
                  $ref: "#/components/schemas/Coding"
              additionalProperties: false
            url:
              type: "string"
              enum:
              - "datumCode"
          description: "Datum codes used"
        url:
          type: "string"
          enum:
          - "http://hl7.org.nz/fhir/StructureDefinition/nz-geocode"
        longitude:
          type: "object"
          properties:
            valueDecimal:
              $ref: "#/components/schemas/decimal"
            url:
              type: "string"
              enum:
              - "longitude"
          description: "The longitude of the geocode"
      description: "New Zealand Geocode. This uses a different datum from that defined\
        \ in the HL7 FHIR specification for a Geocode."
    
    NesEncounter:
      type: "object"
      properties:
        period:
          $ref: "#/components/schemas/Period"
        meta:
          $ref: "#/components/schemas/Meta"
        id:
          $ref: "#/components/schemas/id"
        text:
          $ref: "#/components/schemas/string"
        class:
          $ref: "#/components/schemas/Coding"
        resourceType:
          type: "string"
          enum:
          - "Encounter"
        status:
          type: "string"
          enum:
          - "finished"
   
    
   
          
    Reference:
      type: "object"
      properties:
        reference:
          $ref: "#/components/schemas/string"
        display:
          $ref: "#/components/schemas/string"
        identifier:
          type: "object"
          properties:
              period:
                $ref: "#/components/schemas/Period"
              system:
                $ref: "#/components/schemas/uri"             
              value:
                $ref: "#/components/schemas/string"
              use:
                type: "string"
                description: "The purpose of this identifier."
                enum:
                - "usual"
                - "official"
                - "temp"
                - "nickname"
                - "anonymous"
                - "old"
                - "maiden"              
              id:
                  $ref: "#/components/schemas/string"
              type:
                  $ref: "#/components/schemas/CodeableConcept"
             
      additionalProperties: false
      description: "A reference from one resource to another."
      
    
    Coverage:
      type: "object"
      properties:
        identifier:
          type: "array"
          items:
            $ref: "#/components/schemas/Identifier"
        period:
          $ref: "#/components/schemas/Period"
        payor:
          type: "array"
          items:
            $ref: "#/components/schemas/Reference"
        beneficiary:
          $ref: "#/components/schemas/Reference"
        meta:
          $ref: "#/components/schemas/Meta"
        id:
          $ref: "#/components/schemas/id"
        text:
          $ref: "#/components/schemas/string"
        type:
          $ref: "#/components/schemas/Coding"
        relationship:
          $ref: "#/components/schemas/Coding"
        resourceType:
          type: "string"
          description: "This is an Coverage resource"
          enum:
          - "Coverage"
        status:
          $ref: "#/components/schemas/RestrictedString"
        contained:
          type: "array"
          items:
            anyOf:
            - $ref: "#/components/schemas/Patient"
      additionalProperties: false
      description: "The Entitlement resource exposed by NESEntitlement service."
   
   
    MwsAllergyIntolerance:
        description: Risk of harmful or undesirable, physiological response which is unique
          to an individual and associated with exposure to a substance.
        properties:
          resourceType:
            type: "string"
            enum:
              - "AllergyIntolerance"
            description: This is a AllergyIntolerance resource
           
          id:
            description: The logical id of the resource, as used in the URL for the resource.
              Once assigned, this value never changes.
            $ref: "#/components/schemas/id"
          meta:
            description: The metadata about the resource. This is content that is maintained
              by the infrastructure. Changes to the content might not always be associated
              with version changes to the resource.
            $ref: "#/components/schemas/Meta"
         
        
          text:
            description: A human-readable narrative that contains a summary of the resource
              and can be used to represent the content of the resource to a human. The narrative
              need not encode all the structured data, but is required to contain sufficient
              detail to make it "clinically safe" for a human to just read the narrative.
              Resource definitions may define what content should be represented in the
              narrative to ensure clinical safety.
            type: "string"
         
          contained:
            type: "array"
            items:
              anyOf:
                - $ref: "#/components/schemas/Reference"
                - $ref: "#/components/schemas/NesPractitionerRole"
                - $ref: "#/components/schemas/Patient"
                
          extension:
            type: array
            items:
               anyOf:
                  - required:
                      - "url"
                    type: "object"
                    properties:
                      valueReference:
                         $ref: "#/components/schemas/Reference"
                      url:
                        type: "string"
                        enum:
                          - "http://hl7.org.nz/fhir/StructureDefinition/mws-attester"
                    additionalProperties: false
                  - required:
                        - "url"
                    type: "object"
                    properties:
                      valueDate:
                        $ref: "#/components/schemas/date"
                      url:
                        type: "string"
                        enum:
                          - "http://hl7.org.nz/fhir/StructureDefinition/mws-attested-date"
                    additionalProperties: false
        
        
          identifier:
            description: Business identifiers assigned to this AllergyIntolerance by the
              performer or other systems which remain constant as the resource is updated
              and propagates from server to server.
            items:
              $ref: "#/components/schemas/Identifier"
            type: array
          clinicalStatus:
            description: The clinical status of the allergy or intolerance.
            $ref: "#/components/schemas/CodeableConcept"
          verificationStatus:
            description: Assertion about certainty associated with the propensity, or potential
              risk, of a reaction to the identified substance (including pharmaceutical
              product).
            "$ref": "#/components/schemas/CodeableConcept"
         
          category:
            description: Category of the identified substance.
            items:
              enum:
              - food
              - medication
              - environment
              - biologic
            type: array
         
          criticality:
            description: Estimate of the potential clinical harm, or seriousness, of the
              reaction to the identified substance.
            enum:
            - low
            - high
            - unable-to-assess
       
          code:
            description: 'Code for an allergy or intolerance statement (either a positive
              or a negated/excluded statement).  This may be a code for a substance or pharmaceutical
              product that is considered to be responsible for the adverse reaction risk
              (e.g., "Latex"), an allergy or intolerance condition (e.g., "Latex allergy"),
              or a negated/excluded code for a specific substance or class (e.g., "No latex
              allergy") or a general or categorical negated statement (e.g.,  "No known
              allergy", "No known drug allergies").  Note: the substance for a specific
              reaction may be different from the substance identified as the cause of the
              risk, but it must be consistent with it. For instance, it may be a more specific
              substance (e.g. a brand medication) or a composite product that includes the
              identified substance. It must be clinically safe to only process the ''code''
              and ignore the ''reaction.substance''.  If a receiving system is unable to
              confirm that AllergyIntolerance.reaction.substance falls within the semantic
              scope of AllergyIntolerance.code, then the receiving system should ignore
              AllergyIntolerance.reaction.substance.'
            $ref: "#/components/schemas/CodeableConcept"
          patient:
            description: The patient who has the allergy or intolerance.
            $ref: "#/components/schemas/Reference"
         
          onsetDateTime:
            description: Estimated or actual date,  date-time, or age when allergy or intolerance
              was identified.
            pattern: "^([0-9]([0-9]([0-9][1-9]|[1-9]0)|[1-9]00)|[1-9]000)(-(0[1-9]|1[0-2])(-(0[1-9]|[1-2][0-9]|3[0-1])(T([01][0-9]|2[0-3]):[0-5][0-9]:([0-5][0-9]|60)(\\.[0-9]+)?(Z|(\\+|-)((0[0-9]|1[0-3]):[0-5][0-9]|14:00)))?)?)?$"
            type: string
        
          recordedDate:
            description: The recordedDate represents when this particular AllergyIntolerance
              record was created in the system, which is often a system-generated date.
            $ref: "#/components/schemas/dateTime"
        
          recorder:
            description: Individual who recorded the record and takes responsibility for
              its content.
            "$ref": "#/components/schemas/Reference"
          asserter:
            description: The source of the information about the allergy that is recorded.
            $ref: "#/components/schemas/Reference"
         
          note:
            type: array
            description: Additional narrative about the propensity for the Adverse Reaction,
              not captured in other fields.
            items:
              type: object
              properties:
                text:
                  type: string
            
          reaction:
            description: Details about each adverse reaction event linked to exposure to
              the identified substance.
            items:
              $ref: "#/components/schemas/AllergyIntoleranceReaction"
            type: array
        additionalProperties: false
        required:
        - patient
        - resourceType
    AllergyIntoleranceReaction:
        description: Risk of harmful or undesirable, physiological response which is unique
          to an individual and associated with exposure to a substance.
        properties:
          id:
            description: Unique id for the element within a resource (for internal references).
              This may be any string value that does not contain spaces.
            $ref: "#/components/schemas/string"
         
          manifestation:
            description: Clinical symptoms and/or signs that are observed or associated
              with the adverse reaction event.
            items:
              $ref: "#/components/schemas/CodeableConcept"
            type: array
          
      
        additionalProperties: false
        required:
        - manifestation
          
    
  securitySchemes:
    LambdaAuthorizer:
      type: "apiKey"
      name: "Authorization"
      in: "header"
      x-amazon-apigateway-authtype: "custom"
    api_key:
      type: "apiKey"
      name: "x-api-key"
      in: "header"
    hip-fhir-cog:
      type: "apiKey"
      name: "Authorization"
      in: "header"
      x-amazon-apigateway-authtype: "cognito_user_pools"
 
